<div class="dashboard-container">
  <div>
    <mat-form-field appearance="outline">
      <mat-label>Filtrar por IP</mat-label>
      <input
        matInput
        (input)="filterAnomalies($event)"
        placeholder="Ej. 192.168.1.1"
      />
    </mat-form-field>
    <h2>ğŸš¨ TrÃ¡fico AnÃ³malo Detectado</h2>
    @defer (when chartData$) {
      @if (chartData$ | async) {
        <div class="chart-container">
          <canvas id="anomalyChart"></canvas>
        </div>
      } @else {
        <div class="no-data-container">
          <p>
            âœ… No se han detectado amenazas o trÃ¡fico anÃ³malo en este momento.
          </p>
        </div>
      }
    } @placeholder {
      <div class="loading-container">
        <mat-spinner mode="indeterminate" diameter="75"></mat-spinner>
        <p>Cargando datos de anomalÃ­as del placeholder...</p>
      </div>
    } @loading (minimum 1s; after 500ms) {
      <div class="loading-container">
        <mat-spinner mode="indeterminate" diameter="75"></mat-spinner>
        <p>Cargando datos de anomalÃ­as...</p>
      </div>
    } @error {
      <div class="error-container">
        <p>Error al cargar los datos de trÃ¡fico anÃ³malo</p>
        <button mat-button (click)="retryLoading()">Reintentar</button>
      </div>
    }
  </div>
  <p>Alertas(talvez no haya nada)</p>
  <mat-card *ngFor="let alert of alerts()" color="warn">
    ğŸš¨ Alerta: IP {{ alert.ip }} - Riesgo {{ alert.risk }}
    <p><strong>ğŸš¨ Alerta:</strong> {{ alert.msg }}</p>
    <p><strong>Origen:</strong> {{ alert.src }}</p>
    <p><strong>Destino:</strong> {{ alert.dst }}</p>
    <p><strong>Hora:</strong> {{ alert.timestamp }}</p>
  </mat-card>
  <table mat-table [dataSource]="originalAnomalies" class="mat-elevation-z8">
    <!-- Columna IP de Origen -->
    <ng-container matColumnDef="src_ip">
      <th mat-header-cell *matHeaderCellDef>IP Origen</th>
      <td mat-cell *matCellDef="let row">{{ row._source.src_ip }}</td>
    </ng-container>

    <!-- Columna IP de Destino -->
    <ng-container matColumnDef="dest_ip">
      <th mat-header-cell *matHeaderCellDef>IP Destino</th>
      <td mat-cell *matCellDef="let row">{{ row._source.dest_ip }}</td>
    </ng-container>

    <!-- Columna TamaÃ±o de Paquete -->
    <ng-container matColumnDef="pkt_len">
      <th mat-header-cell *matHeaderCellDef>TamaÃ±o de Paquete</th>
      <td mat-cell *matCellDef="let row">{{ row._source.pkt_len }}</td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="['src_ip', 'dest_ip', 'pkt_len']"></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: ['src_ip', 'dest_ip', 'pkt_len']"
    ></tr>
  </table>

  <button mat-raised-button color="primary" (click)="exportPDF()">
    ğŸ“„ Exportar PDF
  </button>
  <button mat-raised-button color="accent" (click)="exportExcel()">
    ğŸ“Š Exportar Excel
  </button>
  <app-chatbot />
  <div>
    <input [(ngModel)]="inputData.duration" placeholder="DuraciÃ³n" />
    <input [(ngModel)]="inputData.src_bytes" placeholder="Bytes enviados" />
    <input [(ngModel)]="inputData.dst_bytes" placeholder="Bytes recibidos" />
    <input [(ngModel)]="inputData.count" placeholder="Recuento de paquetes" />

    <button (click)="checkAnomaly()">ğŸ” Analizar</button>
    <p>Resultado: {{ anomalyResult }}</p>
  </div>
</div>
